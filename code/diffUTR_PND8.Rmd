---
title: "diffUTR PND8"
output: html_notebook
---

#diffUTR test

```{r}
library(diffUTR)
library(SummarizedExperiment)
library(GenomicRanges)
library(dplyr)
library(ggplot2)
library(reshape2)
library(limma)
library(edgeR)
library(AnnotationHub)
library(ensembldb)


setwd("C:/Users/chabb/Desktop/ETHZ/3. Jahr/6. Semester/Blockkurs/2. Epigenetic mechanism/Project/project6_bc2021")
se <- readRDS("C:/Users/chabb/Desktop/ETHZ/3. Jahr/6. Semester/Blockkurs/2. Epigenetic mechanism/Project/project6_bc2021/data/counts_bins_apa.rds")

cd <- data.frame(colData(se))
pnd8 <- cd$Stage == "PND8"
sePND8 <- se[,pnd8]

ah <- AnnotationHub()
# obtain the identifier of the latest mouse ensembl annotation:
ahid <- rev(query(ah, c("EnsDb", "Mus musculus"))$ah_id)[1]
ensdb <- ah[[ahid]]


bins <- prepareBins(ensdb)

sePND8 <- diffSpliceWrapper(sePND8, design = ~Group)

perGene <- metadata(sePND8)$geneLevel
head(perGene)


#download.file("https://polyasite.unibas.ch/download/atlas/2.0/GRCm38.96/atlas.clusters.2.0.GRCm38.96.bed.gz",
#              destfile="apa.mm38.bed.gz")
#bins <- prepareBins(bins, "apa.mm38.bed.gz")

#sePND8 <- diffSpliceWrapper(sePND8, design = ~Group, excludeTypes = c("CDS","non-coding"))

#Top Gene
plotTopGenes(sePND8)

sePND8 <- geneLevelStats(sePND8, includeTypes="3UTR")
plotTopGenes(sePND8, diffUTR = TRUE)

#Gene profiler
sePND8 <- addNormalizedAssays(sePND8)
deuBinPlot(sePND8,"Jund")
deuBinPlot(sePND8,"Jund", type="condition", colour="condition")
deuBinPlot(sePND8,"Jund", type="sample", colour="condition")

deuBinPlot(rse,"Jund",type="condition",colour="condition") + 
  guides(colour = guide_legend(override.aes = list(size = 3))) +
  scale_colour_manual(values=c(CTRL="darkblue", LTP="red"))

geneBinHeatmap(rse, "Smg6")
```
